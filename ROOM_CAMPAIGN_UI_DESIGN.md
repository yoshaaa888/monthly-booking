# ÈÉ®Â±ãÂà•„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìUIË®≠Ë®à‰ªïÊßòÊõ∏

## üéØ Ê¶ÇË¶Å
ÈÉ®Â±ãÁ∑®ÈõÜÁîªÈù¢ÂÜÖ„Å´„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìÊ©üËÉΩ„ÇíËøΩÂä†„Åó„ÄÅ1ÈÉ®Â±ã1„Ç≠„É£„É≥„Éö„Éº„É≥Âà∂„ÅÆÊéí‰ªñÂà∂Âæ°„ÇíÂÆüÁèæ„Åô„ÇãUIË®≠Ë®à„ÄÇ

## üìç ÂÆüË£ÖÁÆáÊâÄ
- **ÂØæË±°„Éï„Ç°„Ç§„É´**: `includes/admin-ui.php`
- **Áµ±ÂêàÁÆáÊâÄ**: ÈÉ®Â±ãÁ∑®ÈõÜ„Éï„Ç©„Éº„É†ÂÜÖ„ÅÆÊñ∞„Çª„ÇØ„Ç∑„Éß„É≥Ôºàline 474-476„ÅÆÈñìÔºâ
- **Êó¢Â≠ò„Éë„Çø„Éº„É≥Ê¥ªÁî®**: form-sectionÊßãÈÄ†„ÄÅWordPressÊ®ôÊ∫ñUI

## üóÑÔ∏è „Éá„Éº„Çø„Éô„Éº„ÇπÁµ±ÂêàÊà¶Áï•

### wp_monthly_room_campaigns „ÉÜ„Éº„Éñ„É´Ë®≠Ë®à
```sql
CREATE TABLE {$wpdb->prefix}monthly_room_campaigns (
    id mediumint(9) NOT NULL AUTO_INCREMENT,
    room_id mediumint(9) NOT NULL,
    campaign_id mediumint(9) NOT NULL,
    start_date date NOT NULL,
    end_date date NOT NULL,
    is_active tinyint(1) DEFAULT 1,
    created_at datetime DEFAULT CURRENT_TIMESTAMP,
    updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    PRIMARY KEY (id),
    UNIQUE KEY room_campaign_period (room_id, start_date, end_date),
    KEY room_id (room_id),
    KEY campaign_id (campaign_id),
    KEY start_date (start_date),
    KEY end_date (end_date),
    KEY is_active (is_active)
) $charset_collate;
```

### „ÉÜ„Éº„Éñ„É´‰ΩúÊàêÁµ±ÂêàÔºàmonthly-booking.phpÔºâ
```php
// monthly-booking.php „ÅÆ create_tables() „É°„ÇΩ„ÉÉ„ÉâÂÜÖ„Å´ËøΩÂä†
private function create_room_campaigns_table() {
    global $wpdb;
    
    $table_name = $wpdb->prefix . 'monthly_room_campaigns';
    $charset_collate = $wpdb->get_charset_collate();
    
    $sql = "CREATE TABLE $table_name (
        id mediumint(9) NOT NULL AUTO_INCREMENT,
        room_id mediumint(9) NOT NULL,
        campaign_id mediumint(9) NOT NULL,
        start_date date NOT NULL,
        end_date date NOT NULL,
        is_active tinyint(1) DEFAULT 1,
        created_at datetime DEFAULT CURRENT_TIMESTAMP,
        updated_at datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
        PRIMARY KEY (id),
        UNIQUE KEY room_campaign_period (room_id, start_date, end_date),
        KEY room_id (room_id),
        KEY campaign_id (campaign_id),
        KEY start_date (start_date),
        KEY end_date (end_date),
        KEY is_active (is_active)
    ) $charset_collate;";
    
    require_once(ABSPATH . 'wp-admin/includes/upgrade.php');
    dbDelta($sql);
}
```

## üîó AJAX „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà‰ªïÊßò

### campaign-manager.php „Å∏„ÅÆËøΩÂä†
```php
// Êñ∞Ë¶èAJAX„Ç¢„ÇØ„Ç∑„Éß„É≥ÔºàÊó¢Â≠ò„ÅÆ„Ç≥„É≥„Çπ„Éà„É©„ÇØ„Çø„Å´ËøΩÂä†Ôºâ
add_action('wp_ajax_save_campaign_assignment', array($this, 'ajax_save_campaign_assignment'));
add_action('wp_ajax_delete_campaign_assignment', array($this, 'ajax_delete_campaign_assignment'));
add_action('wp_ajax_check_campaign_period_overlap', array($this, 'ajax_check_campaign_period_overlap'));
add_action('wp_ajax_get_room_campaign_assignments', array($this, 'ajax_get_room_campaign_assignments'));
add_action('wp_ajax_get_active_campaigns', array($this, 'ajax_get_active_campaigns'));
add_action('wp_ajax_get_campaign_assignment', array($this, 'ajax_get_campaign_assignment'));
```

### „Ç®„É≥„Éâ„Éù„Ç§„É≥„ÉàÂÆüË£Ö‰ªïÊßò

#### 1. save_campaign_assignment
```php
public function ajax_save_campaign_assignment() {
    check_ajax_referer('monthly_booking_nonce', 'nonce');
    
    if (!current_user_can('manage_options')) {
        wp_send_json_error(__('Insufficient permissions.', 'monthly-booking'));
    }
    
    $assignment_id = sanitize_text_field($_POST['assignment_id']);
    $room_id = intval($_POST['room_id']);
    $campaign_id = intval($_POST['campaign_id']);
    $start_date = sanitize_text_field($_POST['start_date']);
    $end_date = sanitize_text_field($_POST['end_date']);
    $is_active = intval($_POST['is_active']);
    
    // „Éê„É™„Éá„Éº„Ç∑„Éß„É≥
    $validation_result = $this->validate_campaign_assignment($room_id, $campaign_id, $start_date, $end_date, $assignment_id);
    if (is_wp_error($validation_result)) {
        wp_send_json_error($validation_result->get_error_message());
    }
    
    global $wpdb;
    $table_name = $wpdb->prefix . 'monthly_room_campaigns';
    
    $data = array(
        'room_id' => $room_id,
        'campaign_id' => $campaign_id,
        'start_date' => $start_date,
        'end_date' => $end_date,
        'is_active' => $is_active,
        'updated_at' => current_time('mysql')
    );
    
    if ($assignment_id) {
        // Êõ¥Êñ∞
        $result = $wpdb->update($table_name, $data, array('id' => $assignment_id));
    } else {
        // Êñ∞Ë¶è‰ΩúÊàê
        $data['created_at'] = current_time('mysql');
        $result = $wpdb->insert($table_name, $data);
        $assignment_id = $wpdb->insert_id;
    }
    
    if ($result !== false) {
        wp_send_json_success(array('assignment_id' => $assignment_id));
    } else {
        wp_send_json_error(__('Failed to save campaign assignment.', 'monthly-booking'));
    }
}
```

#### 2. check_campaign_period_overlap
```php
public function ajax_check_campaign_period_overlap() {
    check_ajax_referer('monthly_booking_nonce', 'nonce');
    
    $room_id = intval($_POST['room_id']);
    $start_date = sanitize_text_field($_POST['start_date']);
    $end_date = sanitize_text_field($_POST['end_date']);
    $exclude_assignment_id = intval($_POST['assignment_id']);
    
    global $wpdb;
    $table_name = $wpdb->prefix . 'monthly_room_campaigns';
    
    $sql = "SELECT COUNT(*) FROM $table_name 
            WHERE room_id = %d 
            AND is_active = 1 
            AND (
                (%s BETWEEN start_date AND end_date) OR 
                (%s BETWEEN start_date AND end_date) OR 
                (start_date BETWEEN %s AND %s)
            )";
    
    $params = array($room_id, $start_date, $end_date, $start_date, $end_date);
    
    if ($exclude_assignment_id) {
        $sql .= " AND id != %d";
        $params[] = $exclude_assignment_id;
    }
    
    $overlap_count = $wpdb->get_var($wpdb->prepare($sql, $params));
    
    if ($overlap_count > 0) {
        wp_send_json_error(__('Period overlaps with existing campaign assignment.', 'monthly-booking'));
    } else {
        wp_send_json_success();
    }
}
```

#### 3. get_room_campaign_assignments
```php
public function ajax_get_room_campaign_assignments() {
    check_ajax_referer('monthly_booking_nonce', 'nonce');
    
    $room_id = intval($_POST['room_id']);
    
    global $wpdb;
    $assignments_table = $wpdb->prefix . 'monthly_room_campaigns';
    $campaigns_table = $wpdb->prefix . 'monthly_campaigns';
    
    $sql = "SELECT a.*, c.campaign_name, c.discount_type, c.discount_value 
            FROM $assignments_table a 
            LEFT JOIN $campaigns_table c ON a.campaign_id = c.id 
            WHERE a.room_id = %d 
            ORDER BY a.start_date DESC";
    
    $assignments = $wpdb->get_results($wpdb->prepare($sql, $room_id));
    
    wp_send_json_success($assignments);
}
```

#### 4. get_active_campaigns
```php
public function ajax_get_active_campaigns() {
    check_ajax_referer('monthly_booking_nonce', 'nonce');
    
    global $wpdb;
    $table_name = $wpdb->prefix . 'monthly_campaigns';
    
    $campaigns = $wpdb->get_results(
        "SELECT id, campaign_name, discount_type, discount_value 
         FROM $table_name 
         WHERE is_active = 1 
         ORDER BY campaign_name"
    );
    
    wp_send_json_success($campaigns);
}
```

## üé® UI„ÉØ„Ç§„É§„Éº„Éï„É¨„Éº„É†

### 1. „Ç≠„É£„É≥„Éö„Éº„É≥Ë®≠ÂÆö„Çª„ÇØ„Ç∑„Éß„É≥ÔºàÈÉ®Â±ãÁ∑®ÈõÜÁîªÈù¢ÂÜÖÔºâ

```html
<div class="form-section">
    <h3><?php _e('Campaign Assignment', 'monthly-booking'); ?></h3>
    
    <!-- „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì‰∏ÄË¶ß„ÉÜ„Éº„Éñ„É´ -->
    <div class="campaign-assignments-wrapper">
        <div class="campaign-assignments-header">
            <button type="button" id="add-campaign-assignment" class="button button-primary">
                <span class="dashicons dashicons-plus-alt"></span>
                <?php _e('Add Campaign Assignment', 'monthly-booking'); ?>
            </button>
        </div>
        
        <table class="wp-list-table widefat fixed striped campaign-assignments-table">
            <thead>
                <tr>
                    <th scope="col"><?php _e('Campaign', 'monthly-booking'); ?></th>
                    <th scope="col"><?php _e('Period', 'monthly-booking'); ?></th>
                    <th scope="col"><?php _e('Status', 'monthly-booking'); ?></th>
                    <th scope="col"><?php _e('Actions', 'monthly-booking'); ?></th>
                </tr>
            </thead>
            <tbody id="campaign-assignments-list">
                <!-- Êó¢Â≠ò„ÅÆÂâ≤ÂΩì„Åå„Åì„Åì„Å´Ë°®Á§∫„Åï„Çå„Çã -->
                <tr class="campaign-assignment-row" data-assignment-id="1">
                    <td>
                        <strong>Âç≥ÂÖ•Â±ÖÂâ≤</strong><br>
                        <span class="description">20%Ââ≤Âºï</span>
                    </td>
                    <td>
                        2025-01-01 ÔΩû 2025-12-31<br>
                        <span class="description">365Êó•Èñì</span>
                    </td>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox" class="toggle-assignment-status" 
                                   data-assignment-id="1" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="status-text">ÊúâÂäπ</span>
                    </td>
                    <td>
                        <button type="button" class="button edit-assignment" 
                                data-assignment-id="1">Á∑®ÈõÜ</button>
                        <button type="button" class="button delete-assignment" 
                                data-assignment-id="1">ÂâäÈô§</button>
                    </td>
                </tr>
                
                <!-- Ââ≤ÂΩì„Å™„Åó„ÅÆÂ†¥Âêà -->
                <tr id="no-assignments-row" style="display: none;">
                    <td colspan="4" class="no-assignments-message">
                        <?php _e('No campaign assignments found. Click "Add Campaign Assignment" to create one.', 'monthly-booking'); ?>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
</div>
```

### 2. „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìËøΩÂä†/Á∑®ÈõÜ„É¢„Éº„ÉÄ„É´

```html
<!-- „É¢„Éº„ÉÄ„É´„Ç™„Éº„Éê„Éº„É¨„Ç§ -->
<div id="campaign-assignment-modal" class="campaign-modal-overlay" style="display: none;">
    <div class="campaign-modal-content">
        <div class="campaign-modal-header">
            <h2 id="modal-title"><?php _e('Add Campaign Assignment', 'monthly-booking'); ?></h2>
            <button type="button" class="campaign-modal-close">&times;</button>
        </div>
        
        <form id="campaign-assignment-form" class="campaign-modal-body">
            <input type="hidden" id="assignment-id" name="assignment_id" value="">
            <input type="hidden" id="room-id" name="room_id" value="<?php echo $property_id; ?>">
            
            <table class="form-table">
                <tr>
                    <th scope="row">
                        <label for="campaign-select"><?php _e('Campaign', 'monthly-booking'); ?></label>
                    </th>
                    <td>
                        <select id="campaign-select" name="campaign_id" class="regular-text" required>
                            <option value=""><?php _e('Select Campaign', 'monthly-booking'); ?></option>
                            <!-- ÂãïÁöÑ„Å´ÁîüÊàê„Åï„Çå„Çã -->
                            <option value="1">Âç≥ÂÖ•Â±ÖÂâ≤ (20%Ââ≤Âºï)</option>
                            <option value="2">Êó©Ââ≤ (10%Ââ≤Âºï)</option>
                            <option value="3">„Ç≥„Éü„Ç≥„Éü10‰∏áÂÜÜ (Âõ∫ÂÆöÈ°ç)</option>
                        </select>
                        <p class="description">
                            <?php _e('Select from active campaigns in the system.', 'monthly-booking'); ?>
                        </p>
                    </td>
                </tr>
                
                <tr>
                    <th scope="row">
                        <label for="start-date"><?php _e('Start Date', 'monthly-booking'); ?></label>
                    </th>
                    <td>
                        <input type="text" id="start-date" name="start_date" 
                               class="regular-text date-picker" required>
                        <p class="description">
                            <?php _e('Campaign application start date.', 'monthly-booking'); ?>
                        </p>
                    </td>
                </tr>
                
                <tr>
                    <th scope="row">
                        <label for="end-date"><?php _e('End Date', 'monthly-booking'); ?></label>
                    </th>
                    <td>
                        <input type="text" id="end-date" name="end_date" 
                               class="regular-text date-picker" required>
                        <p class="description">
                            <?php _e('Campaign application end date.', 'monthly-booking'); ?>
                        </p>
                    </td>
                </tr>
                
                <tr>
                    <th scope="row">
                        <label for="is-active"><?php _e('Status', 'monthly-booking'); ?></label>
                    </th>
                    <td>
                        <label class="toggle-switch">
                            <input type="checkbox" id="is-active" name="is_active" checked>
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label"><?php _e('Active', 'monthly-booking'); ?></span>
                        <p class="description">
                            <?php _e('Enable or disable this campaign assignment.', 'monthly-booking'); ?>
                        </p>
                    </td>
                </tr>
            </table>
            
            <!-- „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„ÉºË°®Á§∫„Ç®„É™„Ç¢ -->
            <div id="validation-errors" class="notice notice-error" style="display: none;">
                <p></p>
            </div>
        </form>
        
        <div class="campaign-modal-footer">
            <button type="button" class="button button-secondary campaign-modal-close">
                <?php _e('Cancel', 'monthly-booking'); ?>
            </button>
            <button type="submit" form="campaign-assignment-form" class="button button-primary">
                <span id="save-button-text"><?php _e('Save Assignment', 'monthly-booking'); ?></span>
                <span id="save-spinner" class="spinner" style="display: none;"></span>
            </button>
        </div>
    </div>
</div>
```

## üé® CSS „Çπ„Çø„Ç§„É™„É≥„Ç∞

```css
/* „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì„ÉÜ„Éº„Éñ„É´ */
.campaign-assignments-wrapper {
    margin-top: 15px;
}

.campaign-assignments-header {
    margin-bottom: 15px;
}

.campaign-assignments-table {
    margin-bottom: 0;
}

.campaign-assignment-row:hover {
    background-color: #f9f9f9;
}

.no-assignments-message {
    text-align: center;
    color: #666;
    font-style: italic;
    padding: 20px;
}

/* „Éà„Ç∞„É´„Çπ„Ç§„ÉÉ„ÉÅ */
.toggle-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
    margin-right: 10px;
}

.toggle-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.toggle-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.toggle-slider:before {
    position: absolute;
    content: "";
    height: 18px;
    width: 18px;
    left: 3px;
    bottom: 3px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .toggle-slider {
    background-color: #0073aa;
}

input:checked + .toggle-slider:before {
    transform: translateX(26px);
}

.status-text {
    vertical-align: middle;
    font-weight: 500;
}

/* „É¢„Éº„ÉÄ„É´ */
.campaign-modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 100000;
    display: flex;
    align-items: center;
    justify-content: center;
}

.campaign-modal-content {
    background: white;
    border-radius: 4px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
    max-width: 600px;
    width: 90%;
    max-height: 80vh;
    overflow-y: auto;
}

.campaign-modal-header {
    padding: 20px 20px 0;
    border-bottom: 1px solid #ddd;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.campaign-modal-header h2 {
    margin: 0;
    font-size: 18px;
}

.campaign-modal-close {
    background: none;
    border: none;
    font-size: 24px;
    cursor: pointer;
    color: #666;
    padding: 0;
    width: 30px;
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.campaign-modal-close:hover {
    color: #000;
}

.campaign-modal-body {
    padding: 20px;
}

.campaign-modal-footer {
    padding: 15px 20px;
    border-top: 1px solid #ddd;
    text-align: right;
}

.campaign-modal-footer .button {
    margin-left: 10px;
}

/* „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº */
#validation-errors {
    margin: 15px 0;
    padding: 10px;
}

#validation-errors p {
    margin: 0;
}

/* Êó•‰ªò„Éî„ÉÉ„Ç´„Éº */
.date-picker {
    background-image: url('data:image/svg+xml;charset=US-ASCII,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>');
    background-repeat: no-repeat;
    background-position: right 8px center;
    background-size: 16px;
    padding-right: 35px;
}

/* „É¨„Çπ„Éù„É≥„Ç∑„ÉñÂØæÂøú */
@media (max-width: 768px) {
    .campaign-modal-content {
        width: 95%;
        margin: 20px;
    }
    
    .campaign-assignments-table {
        font-size: 14px;
    }
    
    .campaign-assignments-table th,
    .campaign-assignments-table td {
        padding: 8px 4px;
    }
}
```

## üîß JavaScript „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„É≠„Ç∏„ÉÉ„ÇØ

```javascript
jQuery(document).ready(function($) {
    'use strict';
    
    // „É¢„Éº„ÉÄ„É´Ë°®Á§∫/ÈùûË°®Á§∫
    $('#add-campaign-assignment').on('click', function() {
        openCampaignModal();
    });
    
    $('.campaign-modal-close').on('click', function() {
        closeCampaignModal();
    });
    
    // „É¢„Éº„ÉÄ„É´Â§ñ„ÇØ„É™„ÉÉ„ÇØ„ÅßÈñâ„Åò„Çã
    $('#campaign-assignment-modal').on('click', function(e) {
        if (e.target === this) {
            closeCampaignModal();
        }
    });
    
    // „Éï„Ç©„Éº„É†ÈÄÅ‰ø°Âá¶ÁêÜ
    $('#campaign-assignment-form').on('submit', function(e) {
        e.preventDefault();
        
        if (validateCampaignForm()) {
            saveCampaignAssignment();
        }
    });
    
    // Á∑®ÈõÜ„Éú„Çø„É≥
    $(document).on('click', '.edit-assignment', function() {
        const assignmentId = $(this).data('assignment-id');
        loadCampaignAssignment(assignmentId);
    });
    
    // ÂâäÈô§„Éú„Çø„É≥
    $(document).on('click', '.delete-assignment', function() {
        const assignmentId = $(this).data('assignment-id');
        if (confirm('„Åì„ÅÆ„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì„ÇíÂâäÈô§„Åó„Åæ„Åô„ÅãÔºü')) {
            deleteCampaignAssignment(assignmentId);
        }
    });
    
    // „Çπ„ÉÜ„Éº„Çø„Çπ„Éà„Ç∞„É´
    $(document).on('change', '.toggle-assignment-status', function() {
        const assignmentId = $(this).data('assignment-id');
        const isActive = $(this).is(':checked') ? 1 : 0;
        toggleAssignmentStatus(assignmentId, isActive);
    });
    
    // Êó•‰ªò„Éî„ÉÉ„Ç´„ÉºÂàùÊúüÂåñ
    if ($.fn.datepicker) {
        $('.date-picker').datepicker({
            dateFormat: 'yy-mm-dd',
            changeMonth: true,
            changeYear: true,
            minDate: 0 // ‰ªäÊó•‰ª•Èôç„ÅÆ„ÅøÈÅ∏ÊäûÂèØËÉΩ
        });
    }
    
    /**
     * „É¢„Éº„ÉÄ„É´„ÇíÈñã„Åè
     */
    function openCampaignModal(assignmentId = null) {
        if (assignmentId) {
            $('#modal-title').text('Edit Campaign Assignment');
            $('#save-button-text').text('Update Assignment');
        } else {
            $('#modal-title').text('Add Campaign Assignment');
            $('#save-button-text').text('Save Assignment');
            $('#campaign-assignment-form')[0].reset();
            $('#assignment-id').val('');
        }
        
        $('#campaign-assignment-modal').fadeIn(300);
        $('#campaign-select').focus();
    }
    
    /**
     * „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„Çã
     */
    function closeCampaignModal() {
        $('#campaign-assignment-modal').fadeOut(300);
        clearValidationErrors();
    }
    
    /**
     * „Éï„Ç©„Éº„É†„Éê„É™„Éá„Éº„Ç∑„Éß„É≥
     */
    function validateCampaignForm() {
        clearValidationErrors();
        
        const campaignId = $('#campaign-select').val();
        const startDate = $('#start-date').val();
        const endDate = $('#end-date').val();
        const roomId = $('#room-id').val();
        const assignmentId = $('#assignment-id').val();
        
        let errors = [];
        
        // ÂøÖÈ†àÈ†ÖÁõÆ„ÉÅ„Çß„ÉÉ„ÇØ
        if (!campaignId) {
            errors.push('„Ç≠„É£„É≥„Éö„Éº„É≥„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        
        if (!startDate) {
            errors.push('ÈñãÂßãÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        
        if (!endDate) {
            errors.push('ÁµÇ‰∫ÜÊó•„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
        }
        
        // Êó•‰ªòÊï¥ÂêàÊÄß„ÉÅ„Çß„ÉÉ„ÇØ
        if (startDate && endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            
            if (start >= end) {
                errors.push('ÈñãÂßãÊó•„ÅØÁµÇ‰∫ÜÊó•„Çà„ÇäÂâç„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ');
            }
            
            // ÈÅéÂéªÊó•„ÉÅ„Çß„ÉÉ„ÇØ
            const today = new Date();
            today.setHours(0, 0, 0, 0);
            
            if (start < today) {
                errors.push('ÈñãÂßãÊó•„ÅØ‰ªäÊó•‰ª•Èôç„Åß„ÅÇ„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ');
            }
        }
        
        if (errors.length > 0) {
            showValidationErrors(errors);
            return false;
        }
        
        // AJAXÊúüÈñìÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
        return checkPeriodOverlap(roomId, startDate, endDate, assignmentId);
    }
    
    /**
     * ÊúüÈñìÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØÔºàAJAXÔºâ
     */
    function checkPeriodOverlap(roomId, startDate, endDate, assignmentId) {
        let isValid = true;
        
        $.ajax({
            url: ajaxurl,
            type: 'POST',
            async: false, // ÂêåÊúüÂá¶ÁêÜ
            data: {
                action: 'check_campaign_period_overlap',
                room_id: roomId,
                start_date: startDate,
                end_date: endDate,
                assignment_id: assignmentId || '',
                nonce: monthlyBookingAdmin.nonce
            },
            success: function(response) {
                if (!response.success) {
                    showValidationErrors([response.data]);
                    isValid = false;
                }
            },
            error: function() {
                showValidationErrors(['ÊúüÈñìÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ„Åß„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ']);
                isValid = false;
            }
        });
        
        return isValid;
    }
    
    /**
     * „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì‰øùÂ≠ò
     */
    function saveCampaignAssignment() {
        const $form = $('#campaign-assignment-form');
        const $saveButton = $('#save-button-text');
        const $spinner = $('#save-spinner');
        
        $saveButton.hide();
        $spinner.show();
        
        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'save_campaign_assignment',
                ...$form.serializeObject(),
                nonce: monthlyBookingAdmin.nonce
            },
            success: function(response) {
                if (response.success) {
                    closeCampaignModal();
                    refreshCampaignAssignmentsList();
                    showNotice('„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì„Çí‰øùÂ≠ò„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
                } else {
                    showValidationErrors([response.data]);
                }
            },
            error: function() {
                showValidationErrors(['‰øùÂ≠ò‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ']);
            },
            complete: function() {
                $saveButton.show();
                $spinner.hide();
            }
        });
    }
    
    /**
     * „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìÂâäÈô§
     */
    function deleteCampaignAssignment(assignmentId) {
        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'delete_campaign_assignment',
                assignment_id: assignmentId,
                nonce: monthlyBookingAdmin.nonce
            },
            success: function(response) {
                if (response.success) {
                    refreshCampaignAssignmentsList();
                    showNotice('„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì„ÇíÂâäÈô§„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
                } else {
                    alert('ÂâäÈô§„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + response.data);
                }
            },
            error: function() {
                alert('ÂâäÈô§‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        });
    }
    
    /**
     * „Çπ„ÉÜ„Éº„Çø„ÇπÂàá„ÇäÊõø„Åà
     */
    function toggleAssignmentStatus(assignmentId, isActive) {
        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'toggle_assignment_status',
                assignment_id: assignmentId,
                is_active: isActive,
                nonce: monthlyBookingAdmin.nonce
            },
            success: function(response) {
                if (response.success) {
                    const $row = $(`.campaign-assignment-row[data-assignment-id="${assignmentId}"]`);
                    const $statusText = $row.find('.status-text');
                    $statusText.text(isActive ? 'ÊúâÂäπ' : 'ÁÑ°Âäπ');
                    
                    showNotice('„Çπ„ÉÜ„Éº„Çø„Çπ„ÇíÊõ¥Êñ∞„Åó„Åæ„Åó„Åü„ÄÇ', 'success');
                } else {
                    // „Ç®„É©„ÉºÊôÇ„ÅØÂÖÉ„Å´Êàª„Åô
                    const $toggle = $(`.toggle-assignment-status[data-assignment-id="${assignmentId}"]`);
                    $toggle.prop('checked', !isActive);
                    alert('„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + response.data);
                }
            },
            error: function() {
                // „Ç®„É©„ÉºÊôÇ„ÅØÂÖÉ„Å´Êàª„Åô
                const $toggle = $(`.toggle-assignment-status[data-assignment-id="${assignmentId}"]`);
                $toggle.prop('checked', !isActive);
                alert('„Çπ„ÉÜ„Éº„Çø„ÇπÊõ¥Êñ∞‰∏≠„Å´„Ç®„É©„Éº„ÅåÁô∫Áîü„Åó„Åæ„Åó„Åü„ÄÇ');
            }
        });
    }
    
    /**
     * „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì‰∏ÄË¶ßÊõ¥Êñ∞
     */
    function refreshCampaignAssignmentsList() {
        const roomId = $('#room-id').val();
        
        $.ajax({
            url: ajaxurl,
            type: 'POST',
            data: {
                action: 'get_room_campaign_assignments',
                room_id: roomId,
                nonce: monthlyBookingAdmin.nonce
            },
            success: function(response) {
                if (response.success) {
                    $('#campaign-assignments-list').html(response.data);
                }
            }
        });
    }
    
    /**
     * „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„ÉºË°®Á§∫
     */
    function showValidationErrors(errors) {
        const $errorDiv = $('#validation-errors');
        const $errorText = $errorDiv.find('p');
        
        $errorText.html(errors.join('<br>'));
        $errorDiv.show();
    }
    
    /**
     * „Éê„É™„Éá„Éº„Ç∑„Éß„É≥„Ç®„É©„Éº„ÇØ„É™„Ç¢
     */
    function clearValidationErrors() {
        $('#validation-errors').hide();
    }
    
    /**
     * ÈÄöÁü•Ë°®Á§∫
     */
    function showNotice(message, type = 'info') {
        const $notice = $(`
            <div class="notice notice-${type} is-dismissible">
                <p>${message}</p>
                <button type="button" class="notice-dismiss">
                    <span class="screen-reader-text">„Åì„ÅÆÈÄöÁü•„ÇíÈñâ„Åò„Çã</span>
                </button>
            </div>
        `);
        
        $('.wrap h1').after($notice);
        
        // Ëá™ÂãïÂâäÈô§
        setTimeout(function() {
            $notice.fadeOut(function() {
                $(this).remove();
            });
        }, 5000);
    }
    
    /**
     * „Éï„Ç©„Éº„É†„Éá„Éº„Çø„Çí„Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„Å´Â§âÊèõ
     */
    $.fn.serializeObject = function() {
        const o = {};
        const a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };
});
```

## üîå AJAX „Ç®„É≥„Éâ„Éù„Ç§„É≥„Éà‰ªïÊßò

### 1. ÊúüÈñìÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
```php
// Action: check_campaign_period_overlap
// Parameters: room_id, start_date, end_date, assignment_id (optional)
// Response: success/error with message
```

### 2. „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩì‰øùÂ≠ò
```php
// Action: save_campaign_assignment  
// Parameters: assignment_id (optional), room_id, campaign_id, start_date, end_date, is_active
// Response: success/error with assignment data
```

### 3. „Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìÂâäÈô§
```php
// Action: delete_campaign_assignment
// Parameters: assignment_id
// Response: success/error with message
```

### 4. „Çπ„ÉÜ„Éº„Çø„ÇπÂàá„ÇäÊõø„Åà
```php
// Action: toggle_assignment_status
// Parameters: assignment_id, is_active
// Response: success/error with message
```

### 5. Ââ≤ÂΩì‰∏ÄË¶ßÂèñÂæó
```php
// Action: get_room_campaign_assignments
// Parameters: room_id
// Response: success with HTML content
```

## üõ°Ô∏è „Éê„É™„Éá„Éº„Ç∑„Éß„É≥Ë¶Å‰ª∂

### „Éï„É≠„É≥„Éà„Ç®„É≥„Éâ
1. **ÂøÖÈ†àÈ†ÖÁõÆ„ÉÅ„Çß„ÉÉ„ÇØ**: „Ç≠„É£„É≥„Éö„Éº„É≥„ÄÅÈñãÂßãÊó•„ÄÅÁµÇ‰∫ÜÊó•
2. **Êó•‰ªòÊï¥ÂêàÊÄß**: ÈñãÂßãÊó• < ÁµÇ‰∫ÜÊó•
3. **ÈÅéÂéªÊó•„ÉÅ„Çß„ÉÉ„ÇØ**: ÈñãÂßãÊó•„ÅØ‰ªäÊó•‰ª•Èôç
4. **ÊúüÈñìÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ**: AJAX „Å´„Çà„ÇãÊó¢Â≠òÂâ≤ÂΩì„Å®„ÅÆÈáçË§áÁ¢∫Ë™ç

### „Éê„ÉÉ„ÇØ„Ç®„É≥„Éâ
1. **Ê®©Èôê„ÉÅ„Çß„ÉÉ„ÇØ**: `current_user_can('manage_options')`
2. **„Éä„É≥„ÇπÊ§úË®º**: `check_ajax_referer()`
3. **„Éá„Éº„Çø„Çµ„Éã„Çø„Ç§„Ç∫**: `sanitize_text_field()`, `sanitize_key()`
4. **ÂèÇÁÖßÊï¥ÂêàÊÄß**: room_id, campaign_id „ÅÆÂ≠òÂú®Á¢∫Ë™ç
5. **ÊúüÈñìÈáçË§áÈò≤Ê≠¢**: „Éá„Éº„Çø„Éô„Éº„Çπ„É¨„Éô„É´„Åß„ÅÆÈáçË§á„ÉÅ„Çß„ÉÉ„ÇØ
6. **Êó•‰ªòÂ¶•ÂΩìÊÄß**: strtotime() „Å´„Çà„ÇãÊó•‰ªòÊ§úË®º

## üéØ „É¶„Éº„Ç∂„Éì„É™„ÉÜ„Ç£ËÄÉÊÖÆ‰∫ãÈ†Ö

1. **Áõ¥ÊÑüÁöÑÊìç‰Ωú**: „ÉØ„É≥„ÇØ„É™„ÉÉ„ÇØ„Åß„É¢„Éº„ÉÄ„É´Ë°®Á§∫„ÄÅ„Éà„Ç∞„É´„Åß„Çπ„ÉÜ„Éº„Çø„ÇπÂàá„ÇäÊõø„Åà
2. **Ë¶ñË¶öÁöÑ„Éï„Ç£„Éº„Éâ„Éê„ÉÉ„ÇØ**: „É≠„Éº„Éá„Ç£„É≥„Ç∞„Çπ„Éî„Éä„Éº„ÄÅÊàêÂäü/„Ç®„É©„ÉºÈÄöÁü•
3. **„Ç®„É©„Éº„Éè„É≥„Éâ„É™„É≥„Ç∞**: ÂàÜ„Åã„Çä„ÇÑ„Åô„ÅÑ„Ç®„É©„Éº„É°„ÉÉ„Çª„Éº„Ç∏„ÄÅÂÖ•ÂäõÂÄ§‰øùÊåÅ
4. **„É¨„Çπ„Éù„É≥„Ç∑„Éñ**: „É¢„Éê„Ç§„É´Á´ØÊú´„Åß„ÅÆÊìç‰ΩúÊÄßÁ¢∫‰øù
5. **„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£**: „Ç≠„Éº„Éú„Éº„ÉâÊìç‰Ωú„ÄÅ„Çπ„ÇØ„É™„Éº„É≥„É™„Éº„ÉÄ„ÉºÂØæÂøú

„Åì„ÅÆË®≠Ë®à„Å´„Çà„Çä„ÄÅÈÉ®Â±ãÂçò‰Ωç„Åß„ÅÆ„Ç≠„É£„É≥„Éö„Éº„É≥Ââ≤ÂΩìÁÆ°ÁêÜ„ÅåÁõ¥ÊÑüÁöÑ„Åã„Å§ÂÆâÂÖ®„Å´Ë°å„Åà„ÇãUI„ÇíÂÆüÁèæ„Åó„Åæ„Åô„ÄÇ
