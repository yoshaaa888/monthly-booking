# 修正計画（ロードマップ）

## 0. 原則
- 段階的・後方互換を可能な限り確保
- 参照のみの検証→移行オプション提供→最終統一

## 1. 短期（緊急）
- 決定: キャンペーンテーブルは wp_{prefix}monthly_campaigns を正とする（候補）
- booking-logic のキャンペーン参照を monthly_campaigns に切替える設計案を準備（実装は別PR）
- 料金計算: monthly_rates 優先の参照仕様を定義。未設定時のみ default_price をフォールバック

## 2. 中期（1-2週間）
- データスキーマ統一: カラム命名（campaign_name, campaign_description 等）を確定
- アクセス層（Repository/Getter）を導入し、UI/ロジック双方が同一関数を通じて参照
- 入力バリデーション強化（レート欠損・期間重複・重複display_order）
- 管理画面の表示整合（is_active優先/並び順統一/非活性非表示オプションの制御）

## 3. 長期（1ヶ月〜）
- 自動検証: 管理画面に「整合性ダッシュボード」を追加（検出→CSV出力）
- 設定変更ログ/ロールバック
- 自動テスト（レート境界/キャンペーン境界/人数加算/オプション割引）

## 4. マイグレーション指針（スケッチ）
- キャンペーン参照は monthly_campaigns に統一済み（旧テーブルは使用しない）
- カラム差異は今後の整合化で吸収し、段階的に統一

## 5. リスクと緩和
- 計算結果の変動: 検証用シナリオ（見積もり検証表）でリグレッション確認
- データ欠損: 欠損検出SQL → 手動補完フローの運用文書化
- UI影響: 表示順/活性制御のルールを先に合意
