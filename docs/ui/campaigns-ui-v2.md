# キャンペーン管理 UI 改善（一覧 / 新規 / プレビュー）

本ドキュメントは、キャンペーン管理UIの改善要件に基づくワイヤー（PNG）とUIテキスト、そしてPHPテンプレの変更計画（対象ファイル一覧）をまとめたものです。

## 1) 一覧（キャンペーン一覧）
- 列構成
  - 名称
  - 種別（アイコン＋ラベル）
  - 割引（％ or 円）
  - 期間
  - 紐づけ物件数
  - ステータス
  - 操作（編集・複製・無効化）
- フィルタ
  - ステータス / 期間 / 種別
- 主ボタン/操作
  - 新規作成、行アクション（編集 / 複製 / 無効化）
- ワイヤー: docs/ui/wire-campaigns-list-v2.png

UIテキスト例
- ヘッダ: キャンペーン一覧
- フィルタ: 種別 / ステータス / 期間
- 操作: 編集 / 複製 / 無効化
- ステータス: 有効 / 無効
- 空状態: キャンペーンが登録されていません。「新規作成」から追加してください。

表示仕様
- 種別アイコン: 割引方式に応じて表示（率=％アイコン、定額=¥アイコン）
- 割引表示: 「10%」または「¥5,000」のようにフォーマット
- 紐づけ物件数: wp_monthly_room_campaignsから集計した件数

## 2) 新規作成フォーム
- 入力項目
  - キャンペーン名（必須）
  - 割引方式: 定額 or 率（必須）
  - 割引値: 金額（円） or 率（%）（方式に応じて表示）
  - 対象契約タイプ: SS / S / M / L（複数選択可能）
  - 期間タイプ: 固定 / 入居日連動 / 無期限
  - 期間入力: 固定選択時のみ開始日/終了日を表示
  - ステータス: 有効/無効（トグル）
- 主ボタン
  - 保存 / キャンセル
- ワイヤー: docs/ui/wire-campaigns-new-v2.png

UIテキスト例
- ラベル: 割引方式 / 割引値 / 対象契約タイプ / 期間タイプ / 開始日 / 終了日 / ステータス
- プレースホルダ: 選択... / 例: 10（%）/ 5000（円）
- ボタン: 保存 / キャンセル

挙動
- 割引方式の切替で入力UIと単位表示を切替
- 期間タイプが固定以外のときは日付入力を非表示
- 保存時はバリデーション（名称、割引方式、割引値、契約タイプ）

## 3) プレビュー
- 目的
  - 家賃サンプルの入力に対して、割引後金額を即時計算して提示
- 入力
  - 家賃サンプル金額
  - 契約タイプ（SS/S/M/L）
- 表示
  - 割引方式・値に応じた割引後金額
- ワイヤー: docs/ui/wire-campaigns-preview-v2.png

UIテキスト例
- 見出し: 割引プレビュー
- ラベル: 家賃サンプル / 契約タイプ
- 出力: 割引後金額: ¥xxx,xxx
- ボタン: 閉じる

計算ルール（基本）
- 定額: 割引後 = max(0, 家賃 - 金額)
- 率: 割引後 = round(家賃 * (1 - 率/100))

---

## PHPテンプレの変更計画（ファイル一覧）

対象ファイル
- includes/admin-ui.php
  - 一覧テーブルの列追加/変更（種別アイコン列、割引フォーマット、紐づけ物件数、複製ボタン）
  - 新規作成フォームのフィールド拡張（割引方式/値、対象契約タイプ、期間タイプ、固定期間入力、プレビュートリガ）
  - プレビューUI（小さなモーダル or サイドパネル）追加フック
- assets/admin.js
  - 割引方式切替UIの制御（単位/表示切替）
  - プレビュー計算（家賃サンプルの割引後金額の即時計算）
  - 期間タイプ切替による日付フィールド表示/非表示
- includes/campaign-manager.php
  - 必要に応じて、プレビュー計算のサーバ側API化（将来）
  - 紐づけ物件数集計の補助関数（一覧表示用；またはSQL内でJOIN/COUNT）
- includes/ajax.php（存在する場合）
  - 追加のAJAXエンドポイント（プレビュー計算 or 紐づけ数取得）検討

データ項目（DB側の現状尊重）
- 割引方式/値、契約タイプ（SS/S/M/L）、期間タイプ（固定/入居日連動/無期限）は、まずはUIレイヤーで定義・保存先の拡張要否を調査
- 現行テーブル `wp_monthly_campaigns` のカラムに合わせ、追加が必要な場合は別途ADR/DBマイグレーション検討

i18n対応
- 表示テキストは assets/i18n/ja.json のキーで管理（campaigns.* / action.* / common.* を再利用/追加）

---

## 添付ワイヤー（PNG）
- docs/ui/wire-campaigns-list-v2.png
- docs/ui/wire-campaigns-new-v2.png
- docs/ui/wire-campaigns-preview-v2.png
