# Monthly Booking プラグイン テスト操作マニュアル

## 🎯 目的
Local WP環境でMonthly Bookingプラグインの動作を確認し、見積→予約の一連の流れを体験する

---

## 📋 事前準備チェックリスト

### ✅ 必要な環境
- [ ] Windows 11
- [ ] Local WP (Local by Flywheel) インストール済み
- [ ] Node.js 16+ インストール済み
- [ ] Chrome ブラウザ最新版
- [ ] `t-monthlycampaign.local` サイトが起動中

### ✅ 必要なファイル
- [ ] `monthly-booking.zip` (プラグインファイル)
- [ ] `seed_data.sql` (テストデータ)
- [ ] `playwright/` フォルダ (テストスクリプト)

---

## 🚀 セットアップ手順

### Step 1: Local WP サイトの起動
1. **Local WP アプリを起動**
2. **サイト一覧から `t-monthlycampaign` を選択**
3. **「Start site」ボタンをクリック**
4. **緑色の「Running」表示を確認**

### Step 2: Adminer でデータベースにアクセス
1. **Local WP の「Database」タブをクリック**
2. **「Open Adminer」ボタンをクリック**
3. **ブラウザでAdminerが開くことを確認**
   - URL例: `http://t-monthlycampaign.local:8080/adminer/`

### Step 3: テストデータの投入
1. **Adminerで「SQL command」をクリック**
2. **`seed_data.sql` ファイルをテキストエディタで開く**
3. **SQLの内容をすべてコピー**
4. **Adminerのテキストエリアに貼り付け**
5. **「Execute」ボタンをクリック**
6. **成功メッセージを確認**

```sql
-- 実行結果例
Rooms inserted: 5
Options inserted: 9
Campaigns inserted: 2
Customers inserted: 3
Sample bookings inserted: 2
```

### Step 4: プラグインのインストール
1. **WordPress管理画面にアクセス**
   - URL: `http://t-monthlycampaign.local/wp-admin/`
2. **「プラグイン」→「新規追加」をクリック**
3. **「プラグインのアップロード」をクリック**
4. **`monthly-booking.zip` ファイルを選択**
5. **「今すぐインストール」をクリック**
6. **「プラグインを有効化」をクリック**

### Step 5: WordPressページの作成
1. **`test_pages.md` の手順に従って3つのページを作成**
   - 見積もりページ
   - カレンダーページ  
   - テスト結果確認ページ
2. **各ページが正常に表示されることを確認**

---

## 🧪 手動テスト手順

### テスト1: 通常予約（早割キャンペーン適用）

#### 1.1 見積もりページにアクセス
```
URL: http://t-monthlycampaign.local/monthly-estimate/
```

#### 1.2 フォーム入力
- **物件選択**: 「立川マンスリー101号室」を選択
- **チェックイン日**: 今日から35日後の日付を入力（早割適用のため）
- **チェックアウト日**: チェックイン日から60日後を入力（Sプラン）
- **大人数**: 2名
- **子供数**: 0名
- **オプション**: 以下を選択
  - ☑ 調理器具セット (¥6,600)
  - ☑ 食器類 (¥3,900)
  - ☑ 洗剤類 (¥3,800)
- **お名前**: 田中太郎
- **メールアドレス**: test@example.com

#### 1.3 見積計算実行
1. **「見積計算」ボタンをクリック**
2. **計算結果の確認**
   - プラン: S (30-89日)
   - 基本賃料: 日割り × 60日
   - 共益費: ¥2,000 × 60日
   - 初期費用: ¥60,500
   - 人数追加料金: ¥60,000 (大人1名追加)
   - オプション合計: ¥14,300
   - オプション割引: -¥500 (3つ選択)
   - **キャンペーン割引**: 「早割」バッジ表示、10%OFF
   - 最終金額の表示

#### 1.4 予約申し込み
1. **「この内容で申し込む」ボタンをクリック**
2. **成功メッセージの確認**
3. **予約IDの表示確認**

### テスト2: 即入居キャンペーン適用

#### 2.1 フォーム入力（即入居割）
- **物件選択**: 「新宿レジデンス205号室」を選択
- **チェックイン日**: 今日から3日後の日付を入力（即入居割適用）
- **チェックアウト日**: チェックイン日から10日後を入力（SSプラン）
- **大人数**: 1名
- **子供数**: 1名
- **オプション**: 以下を選択
  - ☑ タオル類 (¥2,900)
  - ☑ アメニティ類 (¥3,500)
- **お名前**: 佐藤花子
- **メールアドレス**: sato@example.com

#### 2.2 見積計算・予約確認
1. **見積計算実行**
2. **「即入居」バッジの表示確認**
3. **20%割引の適用確認**
4. **予約申し込み実行**

### テスト3: データベース確認

#### 3.1 Adminerでデータ確認
1. **Adminerにアクセス**
2. **`wp_monthly_bookings` テーブルを確認**
```sql
SELECT * FROM wp_monthly_bookings ORDER BY created_at DESC LIMIT 5;
```
3. **新しい予約データが追加されていることを確認**

#### 3.2 管理画面での確認
1. **WordPress管理画面にアクセス**
2. **「Monthly Room Booking」メニューをクリック**
3. **予約一覧で新しい予約を確認**

---

## 🤖 Playwright自動テスト実行

### 前提条件
```bash
# Node.js がインストールされていることを確認
node --version
npm --version
```

### テスト環境セットアップ
```bash
# テストディレクトリに移動
cd test-environment/playwright

# 依存関係のインストール
npm install

# Playwright ブラウザのインストール
npx playwright install
```

### テスト実行コマンド

#### 通常予約テスト
```bash
npm run test:journey-normal
```

#### キャンペーン適用テスト
```bash
npm run test:journey-campaign
```

#### データベース整合性テスト
```bash
npm run test:db-verification
```

#### 全テスト実行
```bash
npm run test:all
```

### テスト結果の確認
- **コンソール出力**: テスト成功/失敗の結果
- **スクリーンショット**: `test-results/` フォルダに保存
- **レポート**: `playwright-report/` フォルダに生成

---

## 🔍 トラブルシューティング

### よくある問題と解決方法

#### 1. プラグインが有効化できない
**症状**: プラグインアップロード時にエラー
**解決方法**:
- WordPressのバージョンを確認（5.0以上必要）
- PHPバージョンを確認（7.4以上必要）
- プラグインファイルの解凍を確認

#### 2. ショートコードが表示されない
**症状**: `[monthly_booking_estimate]` がそのまま表示される
**解決方法**:
- プラグインが有効化されているか確認
- ページの再読み込み
- WordPress管理画面でプラグイン一覧を確認

#### 3. データベースエラー
**症状**: SQLエラーが発生
**解決方法**:
- テーブル名のプレフィックス確認（`wp_` が正しいか）
- Adminerでテーブル存在確認
- プラグイン再有効化でテーブル再作成

#### 4. AJAX エラー
**症状**: 見積計算ボタンを押してもエラー
**解決方法**:
- ブラウザのコンソールでエラー確認
- WordPressのデバッグモード有効化
- プラグインファイルの権限確認

#### 5. Playwright テストエラー
**症状**: テスト実行時にエラー
**解決方法**:
```bash
# ブラウザの再インストール
npx playwright install --force

# 設定ファイルの確認
cat playwright.config.js

# Local WP サイトが起動しているか確認
curl http://t-monthlycampaign.local
```

---

## 📊 期待される結果

### 成功時の確認ポイント

#### ✅ 見積機能
- [ ] プラン自動判定（SS/S/M/L）
- [ ] 料金計算の正確性
- [ ] オプション割引の適用
- [ ] キャンペーン自動適用
- [ ] バッジ表示

#### ✅ 予約機能
- [ ] 顧客データの保存
- [ ] 予約データの保存
- [ ] オプション関連データの保存
- [ ] 成功メッセージの表示

#### ✅ データベース
- [ ] 新規予約レコードの作成
- [ ] 顧客情報の正確な保存
- [ ] 料金内訳の正確な保存

#### ✅ 管理画面
- [ ] 予約一覧での表示
- [ ] データの編集可能性
- [ ] カレンダー表示

---

## 📞 サポート情報

### ログファイルの場所
- **WordPress**: `wp-content/debug.log`
- **Local WP**: Local WPアプリの「Logs」タブ
- **Playwright**: `test-results/` フォルダ

### デバッグ情報の取得
```bash
# WordPress情報
curl http://t-monthlycampaign.local/wp-admin/admin-ajax.php?action=monthly_booking_debug

# データベース接続確認
mysql -h localhost -u root -p local
```

### 問題報告時の情報
1. **エラーメッセージの全文**
2. **実行した手順**
3. **ブラウザのコンソールログ**
4. **WordPressのバージョン**
5. **プラグインのバージョン**

---

*このマニュアルに従って、Monthly Bookingプラグインの全機能をテストできます。*
*問題が発生した場合は、トラブルシューティングセクションを参照してください。*
